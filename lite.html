<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lifetime</title>
  <style>
    :root{
      --bg:#0b0f14; --fg:#e7eef7; --muted:#a9b3c1; --accent:#7cc4ff; --ok:#34d399; --err:#f87171;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 50% -10%, #152233 15%, #0c121a 60%, var(--bg));
      color:var(--fg); display:grid; place-items:center;
    }
    .center{width: min(780px, 92vw);}

    /* â€”â€” Logo â€”â€” */
    .logo{
      user-select:none; cursor:pointer; text-align:center;
      font-weight:800; font-size: clamp(36px, 8vw, 76px);
      letter-spacing:0.02em; line-height:1;
      background:linear-gradient(135deg,#fff, #b8e1ff 35%, #7cc4ff 60%, #8ef0d6);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 8px 30px rgba(124,196,255,.25));
      transition: transform .25s ease, filter .25s ease;
    }
    .logo:hover{ transform: translateY(-2px) scale(1.02); filter: drop-shadow(0 12px 36px rgba(124,196,255,.33)); }

    /* â€”â€” å¯†ç é¢æ¿ â€”â€” */
    .panel{ width:100%; margin-top: 26px; overflow:hidden; }
    .panel-inner{
      max-width:520px; margin:0 auto; padding:16px; border-radius:16px;
      background: rgba(255,255,255,0.03); backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,0.06);
      transform: translateY(-8px); opacity:0; height:0; pointer-events:none;
      transition: opacity .45s ease, transform .45s ease, height .45s ease;
    }
    .panel.show .panel-inner{ opacity:1; transform: translateY(0); height: 96px; pointer-events:auto; }

    .row{ display:flex; gap:12px; align-items:center; }
    input[type="password"]{
      flex:1; height:48px; border-radius:12px; border:1px solid rgba(255,255,255,0.12);
      background:#0e151e; color:var(--fg); padding:0 14px; font-size:16px;
      outline:none; transition: border-color .2s ease, box-shadow .2s ease;
    }
    input[type="password"]:focus{ border-color:#7cc4ff55; box-shadow:0 0 0 6px rgba(124,196,255,.08); }
    .hint{ margin-top:10px; color:var(--muted); font-size:13px; min-height:1.2em; }
    .hint.err{ color:var(--err); }
    .hint.ok{ color:var(--ok); }

    /* â€”â€” æ–‡æ¡£é¡µ â€”â€” */
    #doc{ display:none; opacity:0; transform: translateY(8px); transition: opacity .4s ease, transform .4s ease; }
    #doc.show{ display:block; opacity:1; transform: translateY(0); }
    .doc-card{
      background:#0f1722; padding:22px; border-radius:18px; border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    h2{margin:0 0 14px 0; font-size:24px}
    p{margin:0 0 10px 0; color:#d7e1ee}
    a{ color:#9bd1ff; text-decoration: none; border-bottom:1px dashed #275b80 }
    a:hover{ border-bottom-style: solid }

    /* å°å°çš„â€œæ™ƒåŠ¨â€åŠ¨ç”»ç”¨äºé”™è¯¯ */
    @keyframes shake {10%, 90% {transform: translateX(-1px);} 20%, 80% {transform: translateX(2px);} 30%, 50%, 70% {transform: translateX(-4px);} 40%, 60% {transform: translateX(4px);} }
    .shake{ animation: shake .45s both; }
  </style>
</head>
<body>
  <main class="center">
    <!-- LOGOï¼šç¬¬ä¸€æ¬¡ç‚¹å‡»å±•å¼€å¯†ç ï¼›è¾“å…¥å¯†ç åå†æ¬¡ç‚¹å‡»è¿›å…¥ -->
    <div id="logo" class="logo" aria-label="Lifetime è¿›å…¥">Lifetime</div>

    <section id="panel" class="panel" aria-live="polite">
      <div class="panel-inner">
        <div class="row">
          <input id="pwd" type="password" inputmode="text" autocomplete="current-password" placeholder="è¾“å…¥å¯†ç â€¦" aria-label="å¯†ç " />
        </div>
        <div id="hint" class="hint">ç‚¹å‡»ä¸Šé¢çš„â€œLifetimeâ€LOGO å±•å¼€/è¿›å…¥</div>
      </div>
    </section>

    <section id="doc" tabindex="-1">
      <div class="doc-card">
        <h2>æ–‡æ¡£é¡µé¢</h2>
        <p>ğŸ‰ è®¤è¯æˆåŠŸï¼è¿™é‡Œæ˜¯ä½ çš„æ–‡æ¡£å†…å®¹å ä½ã€‚æŠŠä½ è¦å±•ç¤ºçš„æ–‡æœ¬ã€å›¾ç‰‡æˆ–é“¾æ¥æ”¾åœ¨è¿™é‡Œå³å¯ã€‚</p>
        <ul>
          <li><a href="#">ç¤ºä¾‹é“¾æ¥ A</a></li>
          <li><a href="#">ç¤ºä¾‹é“¾æ¥ B</a></li>
        </ul>
      </div>
    </section>
  </main>

  <script>
  // =============================
  //  ç®€æ˜“å‰ç«¯å¯†ç é—¨ï¼ˆPBKDF2 æ ¡éªŒï¼‰
  //  âš ï¸ æ³¨æ„ï¼šå‰ç«¯å£ä»¤ä»…ç”¨äºâ€œæŒ¡äººçœ¼â€ï¼Œå¹¶éçœŸæ­£å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚
  //  æ¼”ç¤ºå£ä»¤ï¼šLifetime@2025
  //  å¦‚éœ€æ›´æ¢å£ä»¤ï¼Œè¯·çœ‹åº•éƒ¨çš„ generateHash() è¯´æ˜ã€‚
  // =============================

  // â€”â€” å­˜æ”¾åœ¨å‰ç«¯çš„æ´¾ç”Ÿå‚æ•°ï¼ˆå¯æ›¿æ¢ï¼‰ â€”â€”
  const PBKDF2_ITERATIONS = 120000;
  const SALT_B64 = 'A2yj2keFZDZf0e44woe6NQ==';
  const HASH_B64 = 'h4spXxH7LaP7454kLp9v7DqKMRWXK2doE9BplzdmMDA='; // ç›®æ ‡æ´¾ç”Ÿå€¼ï¼ˆ32å­—èŠ‚ï¼‰

  const $ = (sel) => document.querySelector(sel);
  const logo = $('#logo');
  const panel = $('#panel');
  const panelInner = panel.querySelector('.panel-inner');
  const pwd = $('#pwd');
  const hint = $('#hint');
  const doc = $('#doc');

  // è®°ä½ä¸€æ¬¡ä¼šè¯ï¼ˆåˆ·æ–°ä»æœ‰æ•ˆï¼Œå…³é—­æ ‡ç­¾é¡µåå¤±æ•ˆï¼‰
  const SESSION_KEY = 'lifetime_auth_ok';
  if (sessionStorage.getItem(SESSION_KEY) === '1') showDoc();

  let revealed = false; // æ˜¯å¦å·²å±•å¼€è¾“å…¥æ¡†

  logo.addEventListener('click', async () => {
    if (!revealed) {
      revealPanel();
      return;
    }
    // ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼šå¦‚æœå·²å±•å¼€ï¼Œåˆ™å°è¯•æ ¡éªŒå£ä»¤
    await tryLogin();
  });

  // å…è®¸åœ¨è¾“å…¥æ¡†ä¸­æŒ‰ Enter ä¹Ÿè§¦å‘æ ¡éªŒï¼ˆå¯é€‰ï¼‰
  pwd.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      tryLogin();
    }
  });

  function revealPanel(){
    revealed = true;
    panel.classList.add('show');
    panelInner.classList.add('show');
    setTimeout(() => pwd.focus(), 320);
  }

  async function tryLogin(){
    const pass = pwd.value || '';
    if (!pass) {
      flashHint('è¯·è¾“å…¥å¯†ç ');
      panelInner.classList.add('shake');
      setTimeout(()=>panelInner.classList.remove('shake'), 480);
      return;
    }
    setLoading(true);
    try{
      const ok = await verifyPassword(pass, PBKDF2_ITERATIONS, SALT_B64, HASH_B64);
      if (ok) {
        hint.textContent = 'éªŒè¯æˆåŠŸï¼Œæ­£åœ¨è¿›å…¥â€¦';
        hint.className = 'hint ok';
        sessionStorage.setItem(SESSION_KEY, '1');
        setTimeout(showDoc, 220);
      } else {
        flashHint('å¯†ç ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•', true);
        panelInner.classList.add('shake');
        setTimeout(()=>panelInner.classList.remove('shake'), 480);
      }
    } catch(err){
      console.error(err);
      flashHint('æµè§ˆå™¨ä¸æ”¯æŒ Web Cryptoï¼Œè¯·æ›´æ¢ç°ä»£æµè§ˆå™¨', true);
    } finally {
      setLoading(false);
    }
  }

  function setLoading(loading){
    logo.style.pointerEvents = loading ? 'none' : 'auto';
    pwd.disabled = !!loading;
  }

  function flashHint(text, isErr){
    hint.textContent = text;
    hint.className = 'hint' + (isErr ? ' err' : '');
  }

  function showDoc(){
    // éšè—ç™»å½•åŒº
    panel.style.display = 'none';
    logo.style.display = 'none';
    // æ˜¾ç¤ºæ–‡æ¡£
    doc.classList.add('show');
    doc.focus();
  }

  // â€”â€” å¯†ç æ ¡éªŒï¼šPBKDF2-SHA-256 ä¸å›ºå®šç› â€”â€”
  async function verifyPassword(password, iterations, saltB64, expectedHashB64){
    const enc = new TextEncoder();
    const salt = base64ToArrayBuffer(saltB64);
    const expected = base64ToArrayBuffer(expectedHashB64);

    const keyMaterial = await crypto.subtle.importKey(
      'raw', enc.encode(password), {name:'PBKDF2'}, false, ['deriveBits']
    );
    const bits = await crypto.subtle.deriveBits(
      {name:'PBKDF2', hash:'SHA-256', salt, iterations}, keyMaterial, 256
    );
    const derived = new Uint8Array(bits);
    return constantTimeEqual(derived, new Uint8Array(expected));
  }

  // â€”â€” å·¥å…·ï¼šå¸¸é‡æ—¶é—´æ¯”è¾ƒï¼ŒBase64 â†” ArrayBuffer â€”â€”
  function constantTimeEqual(a, b){
    if (a.length !== b.length) return false;
    let diff = 0; for (let i=0;i<a.length;i++){ diff |= a[i] ^ b[i]; }
    return diff === 0;
  }
  function base64ToArrayBuffer(b64){
    const bin = atob(b64); const len = bin.length; const bytes = new Uint8Array(len);
    for (let i=0;i<len;i++) bytes[i] = bin.charCodeAt(i);
    return bytes.buffer;
  }

  // â€”â€” å¯é€‰ï¼šåœ¨æ§åˆ¶å°ç”Ÿæˆæ–°å£ä»¤çš„ç›ä¸å“ˆå¸Œï¼ˆæ–¹ä¾¿ä½ æ›¿æ¢ä¸Šé¢çš„å¸¸é‡ï¼‰ â€”â€”
  // ä½¿ç”¨æ–¹æ³•ï¼šæ‰“å¼€æ­¤é¡µé¢ â†’ F12 æ‰“å¼€æ§åˆ¶å° â†’ è¿è¡Œï¼š
  //   generateHash('ä½ çš„æ–°å£ä»¤')
  // ç„¶åæŠŠæ‰“å°çš„ iterations/salt/hash è¦†ç›–åˆ°é¡¶éƒ¨å¸¸é‡ä¸­ã€‚
  window.generateHash = async function(pw, iterations = 120000){
    const enc = new TextEncoder();
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(pw), {name:'PBKDF2'}, false, ['deriveBits']);
    const bits = await crypto.subtle.deriveBits({name:'PBKDF2', hash:'SHA-256', salt, iterations}, keyMaterial, 256);
    const hashB64 = btoa(String.fromCharCode(...new Uint8Array(bits)));
    const saltB64 = btoa(String.fromCharCode(...salt));
    console.log({iterations, salt: saltB64, hash: hashB64});
    return {iterations, salt: saltB64, hash: hashB64};
  }
  </script>
</body>
</html>
